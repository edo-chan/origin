# Template Monolith Project

A template repository for a monolithic application using modern technologies.

## Technologies

- **Frontend**:
  - NextJS
  - React
  - Vanilla Extract (CSS-in-JS)

- **Backend**:
  - Rust
  - gRPC
  - PostgreSQL
  - Envoy (HTTP to gRPC transcoding)

- **Infrastructure**:
  - Docker
  - Docker Compose
  - Terraform

## Project Structure

```
.
├── backend/                # Rust backend with gRPC
│   ├── Cargo.toml          # Rust dependencies
│   ├── build.rs            # Proto compilation setup
│   ├── package.json        # Node.js dependencies for TypeScript generation
│   ├── proto/              # Protocol buffer definitions
│   │   └── gen/            # Generated TypeScript types from proto
│   ├── envoy/              # Envoy proxy for HTTP to gRPC transcoding
│   │   ├── Dockerfile      # Envoy container configuration
│   │   ├── envoy.yaml      # Envoy configuration
│   │   └── docker-entrypoint.sh # Startup script for Envoy
│   └── src/                # Rust source code
│       ├── handler/        # gRPC service handlers
│       └── model/          # Database models and logic
│
├── frontend/               # NextJS frontend
│   ├── package.json        # Node.js dependencies
│   ├── next.config.js      # NextJS configuration
│   ├── scripts/            # Build and utility scripts
│   └── src/                # TypeScript source code
│       ├── components/     # React components
│       ├── pages/          # NextJS pages
│       ├── styles/         # Vanilla Extract styles
│       └── utils/          # Utility functions
│
├── terraform/              # Infrastructure as code
│   ├── main.tf             # Main Terraform configuration
│   └── variables.tf        # Terraform variables
│
├── docker-compose.yml      # Docker Compose configuration
├── Tiltfile                # Tilt configuration for development
└── README.md               # Project documentation
```

## Getting Started

### Prerequisites

- Docker and Docker Compose
- Node.js (for local frontend development)
- Rust (for local backend development)
- Terraform (for infrastructure provisioning)

### Local Development

1. **Clone the repository**:
   ```bash
   git clone https://github.com/yourusername/template-monolith.git
   cd template-monolith
   ```

2. **Start the application with Docker Compose**:
   ```bash
   docker-compose up
   ```

3. **Access the application**:
   - Frontend: http://localhost:3000
   - Backend: http://localhost:50051 (gRPC)

### Development with Tilt

[Tilt](https://tilt.dev/) provides a streamlined development workflow:

1. **Install Tilt** following the [official instructions](https://docs.tilt.dev/install.html)

2. **Start the development environment**:
   ```bash
   tilt up
   ```

3. **Access the Tilt UI** at http://localhost:10350 to monitor services and logs

Tilt will automatically:
- Start all services (PostgreSQL, Backend, Envoy, Frontend)
- Watch for changes and rebuild/restart services as needed
- Generate TypeScript types from Protocol Buffers when the backend is built

### Development Without Docker

#### Backend (Rust)

1. **Navigate to the backend directory**:
   ```bash
   cd backend
   ```

2. **Build and run the backend**:
   ```bash
   cargo build
   cargo run
   ```

#### Frontend (NextJS)

1. **Navigate to the frontend directory**:
   ```bash
   cd frontend
   ```

2. **Install dependencies**:
   ```bash
   npm install
   ```

3. **Start the development server**:
   ```bash
   npm run dev
   ```

Note: TypeScript types are generated by the backend's build process. Make sure to build the backend first to generate the types.

### Deployment

#### Using Terraform

1. **Initialize Terraform**:
   ```bash
   cd terraform
   terraform init
   ```

2. **Plan the deployment**:
   ```bash
   terraform plan
   ```

3. **Apply the configuration**:
   ```bash
   terraform apply
   ```

## Features

- **Rust Backend**: High-performance, safe, and concurrent backend using Rust.
- **gRPC API**: Efficient communication between frontend and backend using gRPC.
- **PostgreSQL**: Robust relational database for data persistence.
- **Envoy Proxy**: HTTP to gRPC transcoding for easier API consumption.
- **TypeScript Code Generation**: Automatically generate TypeScript types from Protocol Buffers.
- **NextJS Frontend**: Server-side rendering, static site generation, and more with NextJS.
- **Vanilla Extract**: Type-safe CSS-in-JS with zero runtime.
- **Docker & Docker Compose**: Containerized development and deployment.
- **Terraform**: Infrastructure as code for easy deployment.
- **Tilt**: Streamlined local development workflow.

### HTTP to gRPC Transcoding

The Envoy proxy provides HTTP to gRPC transcoding, allowing you to call gRPC services using standard HTTP/JSON:

- **gRPC Endpoint**: `localhost:50051` (direct gRPC calls)
- **HTTP Endpoint**: `http://localhost:8080/service.Greeter/SayHello` (JSON over HTTP)

Example HTTP request:
```bash
curl -X POST http://localhost:8080/service.Greeter/SayHello \
  -H 'Content-Type: application/json' \
  -d '{"name": "World"}'
```

### TypeScript Type Generation

TypeScript interfaces are automatically generated from the Protocol Buffer definitions during the backend build process:

- Generated files are stored in `backend/proto/gen/`
- Types are generated when the backend is built (via `build.rs`)
- The frontend imports these types directly from the backend directory
- The generation uses the `protoc-gen-ts_proto` plugin for optimal TypeScript output

## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the LICENSE file for details.
